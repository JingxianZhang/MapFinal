<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="https://code.jquery.com/jquery-1.12.4.js"></script>
<link rel="stylesheet" href="http://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
<style type="text/css">

/* On mouse hover, lighten state color */
path:hover {
    fill-opacity: .7;
}
.axis line {
  fill: #444;
  stroke: #444;
  shape-rendering: crispEdges;
}
.axis path {
  fill: none;
  stroke: none;
  shape-rendering: crispEdges;
}

/* Style for Custom Tooltip */
div.tooltip {   
    position: absolute;           
    text-align: center;           
    width: 60px;                  
    height: 28px;                 
    padding: 2px;             
    font: 12px sans-serif;        
    background: white;   
    border: 0px;      
    border-radius: 8px;           
    pointer-events: none;  
    display: none;
}
        

body {
    font-family: Gill Sans, sans-serif;
    font: 11px sans-serif;
    position: absolute;
    width: 100%;
    height: 100%;
    background: rgb(240,190,72);
}
.top_bar{
    position: relative;
    width: 100%;
    height: 12%;
    /*background: black;*/
} 
.one_food{
    position: relative;
    float: left;
    left: 25px;
    width: 60px;
    height: 60px;
    margin-left: 20px;
    margin-right: 20px;
    margin-top: 10px;
    /*border-radius: 200px;*/
    /*background: rgb(240,240,240);*/
    /*box-shadow: 1px 1px 10px #888888;*/
}
.food_pic{
    position: relative;
    float: left;
    width: 60px;
    height: 60px;
}
.slider{
    position: relative;
    width: 12%;
    height: 88%;
    /*background: green;*/
}
#slider-range{
    position: relative;
    left: 50px;
    top: 110px; 
    width: 10px;
    height: 450px;
    background: rgb(100,100,100);
}
.ui-slider-handle{
    left: -10px;
    width: 32px;
    height: 32px;
    border-radius: 30px;
}
.main{
    position: relative;
    top: -92%;
    left: 12%;
    width: 88%;
    height: 88%;
    /*background: cyan;*/
}
/* Legend Position Style */
.legend {
    font-family: Gill Sans, sans-serif;
    position:absolute;
    left:35%;
    top:87%;
}
.legend text{
    fill: #444;
}
</style>
</head>
<body>
    <div class="top_bar">
        <div id="food_list"></div>
        <div id="cost"></div>
    </div>
    <div class="slider">
        <div id="range-slider">
            <div id="slider-range"></div>
        </div>
    </div>
    <div class="main"></div>
<script type="text/javascript">
var food_selected = location.search.substr(1).split("=")[1].split("&");
var the_json;
d3.select(".top_bar").select("#food_list").selectAll(".one_food").data(food_selected)
        .enter().append("div").attr("class", "one_food")
        .append("img").attr("class", "food_pic").attr("id", function(d){ return d;})
        .attr("src", function(d){ return "images/" + d + ".png";}).attr("alt", function(d){ return d;});
d3.select(".top_bar").append("div").attr("id", "total_cost").text();
$( "#slider-range" ).slider({
    orientation: "vertical",
    min: 2015,
    max: 2095,
    value: 2015,
    slide: function(event, ui){
        svg.selectAll("path")
                .style("fill", function(d) {

                // Get data value
                var the_value = d.properties.visited;
                var delta = d.properties.delta;

                if (the_value) {
                    //If value exists…
                    return color(((the_value - delta * (ui.value - 2015))/maximum)>=0? ((the_value - delta * (ui.value - 2015))/maximum) : 0);
                } else {
                    //If value is undefined…
                    return "rgb(213,222,217)";
                }
        });
    }
});
$(".ui-slider-handle").css({
    left: "-12px",
    width: "32px",
    height: "32px",
    "border-radius": "30px",
    outline: "none",
    background: "rgb(243, 243, 243)"
});
	
//Width and height of map
var width = 960*1.1;
var height = 500*1.3;
// D3 Projection
var projection = d3.geo.albersUsa()
                   .translate([width/2, height/2])    // translate to center of screen
                   .scale([1000]);          // scale things down so see entire US
        
// Define path generator
var path = d3.geo.path()               // path generator that will convert GeoJSON to SVG paths
             .projection(projection);  // tell path generator to use albersUsa projection

		
// Define linear scale for output
//var color = d3.scale.linear()
//              .range(["rgb(213,222,217)","rgb(69,173,168)","rgb(84,36,55)","rgb(217,91,67)"]);
var minimum = 0, maximum = 100;
var minimumColor = "#d5ded9", maximumColor = "#d95b43";
var color = d3.scale.linear().domain([minimum, maximum]).range([minimumColor, maximumColor]);

var legendText = ["Cities Lived", "States Lived", "States Visited", "Nada"];

//Create SVG element and append map to the SVG
var svg = d3.select("body").select(".main")
            .append("svg")
            .attr("width", width)
            .attr("height", height);
        
// Append Div for tooltip to SVG
var div = d3.select("body").select(".main")
            .append("div")   
            .attr("class", "tooltip")               
            .style("opacity", 0);

// Load in my states data!
d3.csv("data.csv", function(data) {
    color.domain([0,1,2,3]); // setting the range of the input data

    // Load GeoJSON data and merge with states data
    d3.json("us-states.json", function(json) {
        the_json = json;
        // Loop through each state data value in the .csv file
        for (var i = 0; i < data.length; i++) {

                // Grab State Name
                var dataState = data[i].state;

                // Grab data value 
                var dataValue = data[i].visited;
                var deltaValue = data[i].delta;

                // Find the corresponding state inside the GeoJSON
                for (var j = 0; j < json.features.length; j++)  {
                    var jsonState = json.features[j].properties.name;

                    if (dataState == jsonState) {

                        // Copy the data value into the JSON
                        json.features[j].properties.visited = dataValue; 
                        json.features[j].properties.delta = deltaValue; 

                        // Stop looking through the JSON
                        break;
                    }
                }
        }

        // Bind the data to the SVG and create one path per GeoJSON feature
        svg.selectAll("path")
                .data(json.features)
                .enter()
                .append("path")
                .attr("d", path)
                .style("stroke", "#fff")
                .style("stroke-width", "1")
                .style("fill", function(d) {

                // Get data value
                var value = d.properties.visited;
                var delta = d.properties.delta;

                if (value) {
                    //If value exists…
                    return color(value/maximum);
                } else {
                    //If value is undefined…
                    return "rgb(213,222,217)";
                }
        });



        // Modified Legend Code from Mike Bostock: http://bl.ocks.org/mbostock/3888852
        var w = 450, h = 115;
        var legend = d3.select("body").append("svg")
                .attr("class", "legend")
                .attr("width", w)
                .attr("height", h)
                .append("g");
//                .selectAll("g")
//                .data(color.domain().slice().reverse())
//                .enter()
//                .append("g")
                

        var the_legend = legend.append("defs").append("svg:linearGradient").attr("id", "gradient").attr("x1", "0%").attr("x2", "100%").attr("spreadMethod", "pad");
        the_legend.append("stop").attr("offset", "0%").attr("stop-color", maximumColor).attr("stop-opacity", 1);
        the_legend.append("stop").attr("offset", "100%").attr("stop-color", minimumColor).attr("stop-opacity", 1);
        legend.append("rect").attr("width", w - 150).attr("height", h - 100)
                .style("fill", "url(#gradient)").attr("transform", "translate(100,25)");
        var x = d3.scale.linear().range([300, 0]).domain([minimum, maximum]);
        var xAxis = d3.svg.axis().scale(x).orient("bottom").ticks(5);
        legend.append("g").attr("class", "x axis").attr("transform", "translate(101,40)")
                .call(xAxis).append("text")
                .attr("x", -15).attr("y", -3).attr("dx", ".7em")
                .style("text-anchor", "end").text("Number of Colonies");

    });

});
</script>
</body>
</html>